string1Params =[
    {
        name:'hs',
        digitsNum: 1,
        lowDigitPrice:1,
        range: '0..15',
        unit: 'безразмерная',
        value:0
    },
    {
        name:'m',
        digitsNum: 4,
        lowDigitPrice:1,
        range: '0..15',
        unit: 'безразмерная',
        value:1
    },
    {
        name:'-',
        digitsNum: 2,
        lowDigitPrice:'-',
        range: '-',
        unit: '-',
        value:0
    },
    {
        name:'P1',
        digitsNum: 2,
        lowDigitPrice:'*',
        range: '*',
        unit: '*',
        value:null
    },
    {
        name:'t<sub>k</sub>',
        digitsNum: 5,
        lowDigitPrice:1,
        range: '0..23',
        unit: 'час',
        value:null
    },
    {
        name:'t<sub>k</sub>',
        digitsNum: 6,
        lowDigitPrice:1,
        range: '0..59',
        unit: 'мин',
        value:null
    },
    {
        name:'t<sub>k</sub>',
        digitsNum: 1,
        lowDigitPrice:30,
        range: '0;30',
        unit: 'с',
        value:null
    },
    {
        name:"x<sub>n</sub>'(t<sub>b</sub>)",
        digitsNum: 24,
        lowDigitPrice:'2<sup>-20</sup>',
        range: '±4.3',
        unit: 'км/с',
        value:null
    },
    {
        name:"x<sub>n</sub>''(t<sub>b</sub>)",
        digitsNum: 5,
        lowDigitPrice:'2<sup>-30</sup>',
        range: '±6.2e-9',
        unit: 'км/с<sup>2</sup>',
        value:null
    },
    {
        name:"x<sub>n</sub>(t<sub>b</sub>)",
        digitsNum: 27,
        lowDigitPrice:'2<sup>-11</sup>',
        range: '±2.7e4',
        unit: 'км',
        value:null
    }                                   
]

string2Params =[
    {
        name:'hs',
        digitsNum: 1,
        lowDigitPrice:1,
        range: '0..15',
        unit: 'безразмерная',
        value:0
    },
    {
        name:'m',
        digitsNum: 4,
        lowDigitPrice:1,
        range: '0..15',
        unit: 'безразмерная',
        value:2
    },
    {
        name:'B<sub>n</sub>',
        digitsNum: 3,
        lowDigitPrice:1,
        range: '0..7',
        unit: 'безразмерная',
        value:null
    },
    {
        name:'P2',
        digitsNum: 1,
        lowDigitPrice:1,
        range: '0;1',
        unit: 'безразмерная',
        value:null
    },
    {
        name:'t<sub>b</sub>',
        digitsNum: 7,
        lowDigitPrice:15,
        range: '15..1425',
        unit: 'мин',
        value:null
    },
    {
        name:'-',
        digitsNum: 6,
        lowDigitPrice:1,
        range: '0..59',
        unit: 'мин',
        value:null
    },
    {
        name:'t<sub>b</sub>',
        digitsNum: 1,
        lowDigitPrice:30,
        range: '0;30',
        unit: 'с',
        value:null
    },
    {
        name:"y<sub>n</sub>'(t<sub>b</sub>)",
        digitsNum: 24,
        lowDigitPrice:'2<sup>-20</sup>',
        range: '±4.3',
        unit: 'км/с',
        value:null
    },
    {
        name:"y<sub>n</sub>''(t<sub>b</sub>)",
        digitsNum: 5,
        lowDigitPrice:'2<sup>-30</sup>',
        range: '±6.2e-9',
        unit: 'км/с<sup>2</sup>',
        value:null
    },
    {
        name:"y<sub>n</sub>(t<sub>b</sub>)",
        digitsNum: 27,
        lowDigitPrice:'2<sup>-11</sup>',
        range: '±2.7e4',
        unit: 'км',
        value:null
    }                                   
]

string3Params =[
    {
        name:'hs',
        digitsNum: 1,
        lowDigitPrice:1,
        range: '0..15',
        unit: 'безразмерная',
        value:0
    },
    {
        name:'m',
        digitsNum: 4,
        lowDigitPrice:1,
        range: '0..15',
        unit: 'безразмерная',
        value:3
    },
    {
        name:'P3',
        digitsNum: 1,
        lowDigitPrice:1,
        range: '0;1',
        unit: 'безразмерная',
        value:null
    },
    {
        name:'γ<sub>n</sub>(t<sub>b</sub>)',
        digitsNum: 11,
        lowDigitPrice:'2<sup>-40</sup>',
        range: '±2<sup>-30</sup>',
        unit: 'безразмерная',
        value:null
    },
    {
        name:'-',
        digitsNum: 1,
        lowDigitPrice:1,
        range: '-',
        unit: '-',
        value:null
    },
    {
        name:'P',
        digitsNum: 2,
        lowDigitPrice:1,
        range: '00,01,10,11',
        unit: 'безразмерная',
        value:null
    },
    {
        name:'l<sub>n</sub>',
        digitsNum: 1,
        lowDigitPrice:1,
        range: '0;1',
        unit: 'безразмерная',
        value:null
    },
    {
        name:"z<sub>n</sub>'(t<sub>b</sub>)",
        digitsNum: 24,
        lowDigitPrice:'2<sup>-20</sup>',
        range: '±4.3',
        unit: 'км/с',
        value:null
    },
    {
        name:"z<sub>n</sub>''(t<sub>b</sub>)",
        digitsNum: 5,
        lowDigitPrice:'2<sup>-30</sup>',
        range: '±6.2e-9',
        unit: 'км/с<sup>2</sup>',
        value:null
    },
    {
        name:"z<sub>n</sub>(t<sub>b</sub>)",
        digitsNum: 27,
        lowDigitPrice:'2<sup>-11</sup>',
        range: '±2.7e4',
        unit: 'км',
        value:null
    }                                   
]

string4Params =[
    {
        name:'hs',
        digitsNum: 1,
        lowDigitPrice:1,
        range: '0..15',
        unit: 'безразмерная',
        value:0
    },
    {
        name:'m',
        digitsNum: 4,
        lowDigitPrice:1,
        range: '0..15',
        unit: 'безразмерная',
        value:4
    },
    {
        name:'τ<sub>n</sub>(t<sub>b</sub>)',
        digitsNum: 22,
        lowDigitPrice:'2<sup>-30</sup>',
        range: '±2<sup>-9</sup>',
        unit: 'с',
        value:null
    },
    {
        name:'Δτ<sub>n</sub>(t<sub>b</sub>)',
        digitsNum: 5,
        lowDigitPrice:'2<sup>-30</sup>',
        range: '±13.97e-9',
        unit: 'с',
        value:null
    },
    {
        name:'E<sub>n</sub>',
        digitsNum: 5,
        lowDigitPrice:1,
        range: '0..31',
        unit: 'безразмерная',
        value:null
    },
    {
        name:'-',
        digitsNum: 14,
        lowDigitPrice:'-',
        range: '-',
        unit: '-',
        value:null
    },
    {
        name:'P4',
        digitsNum: 1,
        lowDigitPrice:1,
        range: '0;1',
        unit: 'безразмерная',
        value:null
    },
    {
        name:"F<sub>T</sub>",
        digitsNum: 4,
        lowDigitPrice:'*',
        range: '*',
        unit: '*',
        value:null
    },
    {
        name:"-",
        digitsNum: 3,
        lowDigitPrice:'-',
        range: '-',
        unit: '-',
        value:null
    },
    {
        name:"N<sub>T</sub>",
        digitsNum: 11,
        lowDigitPrice:1,
        range: '0..1461',
        unit: 'сутки',
        value:null
    },
    {
        name:"n",
        digitsNum: 5,
        lowDigitPrice:1,
        range: '0..31',
        unit: 'безразмерная',
        value:null
    },
    {
        name:"M",
        digitsNum: 2,
        lowDigitPrice:1,
        range: '0..3',
        unit: 'безразмерная',
        value:null
    }                                            
]

string5Params =[
    {
        name:'hs',
        digitsNum: 1,
        lowDigitPrice:1,
        range: '0..15',
        unit: 'безразмерная',
        value:0
    },
    {
        name:'m',
        digitsNum: 4,
        lowDigitPrice:1,
        range: '0..15',
        unit: 'безразмерная',
        value:5
    },
    {
        name:'N<sup>A</sup>',
        digitsNum: 11,
        lowDigitPrice:1,
        range: '0..1461',
        unit: 'сутки',
        value:null
    },
    {
        name:'τ<sub>с</sub>',
        digitsNum: 32,
        lowDigitPrice:'2<sup>-31</sup>',
        range: '±1',
        unit: 'с',
        value:null
    },
    {
        name:'-',
        digitsNum: 1,
        lowDigitPrice:1,
        range: '-',
        unit: '-',
        value:null
    },
    {
        name:'N<sub>4</sub>',
        digitsNum: 5,
        lowDigitPrice:1,
        range: '1-31',
        unit: '4-х летний интервал',
        value:null
    },
    {
        name:'τ<sub>GPS</sub>',
        digitsNum: 22,
        lowDigitPrice:'2<sup>-30</sup>',
        range: '±1.9e-3',
        unit: 'c',
        value:null
    },
    {
        name:'l<sub>n</sub>',
        digitsNum: 1,
        lowDigitPrice:1,
        range: '0;1',
        unit: 'безразмерная',
        value:null
    }                                 
]

string6Params = [
    {
        name:'hs',
        digitsNum: 1,
        lowDigitPrice:1,
        range: '0..15',
        unit: 'безразмерная',
        value:0
    },
    {
        name:'m',
        digitsNum: 4,
        lowDigitPrice:1,
        range: '0..15',
        unit: 'безразмерная',
        value:6
    },
    {
        name:'C<sup>n</sup>',
        digitsNum: 1,
        lowDigitPrice:1,
        range: '0..1',
        unit: 'безразмерная',
        value:null
    },
    {
        name:'M<sub>n</sub><sup>A</sup>',
        digitsNum: 2,
        lowDigitPrice:1,
        range: '0..3',
        unit: 'безразмерная',
        value:null
    },
    {
        name:'n<sup>A</sup>',
        digitsNum: 5,
        lowDigitPrice:1,
        range: '1..24',
        unit: 'безразмерная',
        value:null
    },
    {
        name:'τ<sub>n</sub><sup>A</sup>',
        digitsNum: 10,
        lowDigitPrice:'2<sup>-18</sup>',
        range: '±1.9e-3',
        unit: 'c',
        value:null
    },
    {
        name:'λ<sub>n</sub><sup>A</sup>',
        digitsNum: 21,
        lowDigitPrice:'2<sup>-20</sup>',
        range: '±1',
        unit: 'полуцикл',
        value:null
    },
    {
        name:'Δi<sub>n</sub><sup>A</sup>',
        digitsNum: 18,
        lowDigitPrice:'2<sup>-20</sup>',
        range: '±0.067',
        unit: 'полуцикл',
        value:null
    },
    {
        name:'ε<sub>n</sub><sup>A</sup>',
        digitsNum: 15,
        lowDigitPrice:'2<sup>-20</sup>',
        range: '0..0.03',
        unit: 'безразмерная',
        value:null
    }                               
]

string7Params = [
    {
        name:'hs',
        digitsNum: 1,
        lowDigitPrice:1,
        range: '0..15',
        unit: 'безразмерная',
        value:0
    },
    {
        name:'m',
        digitsNum: 4,
        lowDigitPrice:1,
        range: '0..15',
        unit: 'безразмерная',
        value:7
    },
    {
        name:'ω<sub>n</sub><sup>A</sup>',
        digitsNum: 16,
        lowDigitPrice:'2<sup>-15</sup>',
        range: '±1',
        unit: 'полуцикл',
        value:null
    },
    {
        name:'t<sub>λn</sub><sup>A</sup>',
        digitsNum: 21,
        lowDigitPrice:'2<sup>-5</sup>',
        range: '0..44100',
        unit: 'c',
        value:null
    },
    {
        name:'ΔT<sub>n</sub><sup>A</sup>',
        digitsNum: 22,
        lowDigitPrice:'2<sup>-9</sup>',
        range: '±3.6e3',
        unit: 'c/виток',
        value:null
    },
    {
        name:"ΔT'<sub>n</sub><sup>A</sup>",
        digitsNum: 7,
        lowDigitPrice:'2<sup>-14</sup>',
        range: '±2<sup>-8</sup>',
        unit: 'c/виток<sup>2<sup>',
        value:null
    },
    {
        name:'H<sub>n</sub><sup>A</sup>',
        digitsNum: 5,
        lowDigitPrice:'1',
        range: '0..31',
        unit: 'безразмерная',
        value:null
    },
    {
        name:'l<sub>n</sub>',
        digitsNum: 1,
        lowDigitPrice:1,
        range: '0;1',
        unit: 'безразмерная',
        value:null
    }                                
]

function SuperFrame(frameNum){
    this.frameNum = frameNum;
}

function Frame(stringNum){
    this.stringNum = stringNum;
    this.strings = [];
}
function NavString(parentName){
    this.parentName = parentName;
}    

var superFrame = new SuperFrame(5);
var frames = [];
for(var i = 0; i < superFrame.frameNum ; i++){
    frames.push(new Frame(15));
    frames[i].name = "frame" + i;
    for(var j = 0; j < frames[i].stringNum ; j++){
        frames[i].strings.push(new NavString(frames[i].name));
    }
}

function makeList(superFrame,frames){
    var superFrameList = document.createElement('ul');
    superFrameList.classList.add('superframe-list')

    frames.forEach(function(frame,frameNum){
        var frameElem = document.createElement('li');
        frameElem.classList.add('frame');
        frameElem.setAttribute('data-frame-id',frameNum + 1);
        frameElem.onclick = selectFrame;
        frameElem.innerHTML = 'Кадр № ' + (frameNum + 1);
        var stringList = document.createElement('ul');
        stringList.classList.add('nav-string-list');
        frameElem.appendChild(stringList);

        frame.strings.forEach(function(string, stringNum){
            var stringElem = document.createElement('li')
            stringElem.classList.add('nav-string');
            stringElem.onclick = selectNavString;
            stringElem.setAttribute('data-string-id',stringNum + 1)
            if(stringNum < 4){
                stringElem.innerHTML = 'Строка №' + (stringNum + 1) + ' Опер. инфо (излучающий НКА)';
            }else{
                if(stringNum > 4){
                    var almanNKA = Math.ceil((frameNum*10 + (stringNum - 4))/2);

                    stringElem.innerHTML = 'Строка №' + (stringNum + 1) + ' Неопер. инфо (Альманах, спутник №' + almanNKA + ')';
                    if(almanNKA == 25) stringElem.innerHTML  = 'Строка №' + (stringNum + 1) + ' Неопер. инфо';
                }else{
                    
                    stringElem.innerHTML = 'Строка №' + (stringNum + 1) + ' Неопер. инфо для всех НКА';
                }
            }
            stringList.appendChild(stringElem);
        })
        superFrameList.appendChild(frameElem);
    })
    superFrameWrapper.appendChild(superFrameList);
};

function makeTables(superFrame, frames){
    frames.forEach(function(frame,frameNum){
        frame.strings.forEach(function(string, stringNum){
            if(stringNum === 1){
                string.params = string1Params.slice();
                renderTable(string,stringNum,frameNum);
            }else if (stringNum === 2){
                string.params = string2Params.slice();
                renderTable(string,stringNum,frameNum);
            }else if (stringNum === 3){
                string.params = string3Params.slice();
                renderTable(string,stringNum,frameNum);
            }else if (stringNum === 4){
                string.params = string4Params.slice();
                renderTable(string,stringNum,frameNum);
            }else if (stringNum === 5){
                string.params = string5Params.slice();
                renderTable(string,stringNum,frameNum);
            }else if ((stringNum === 6) || (stringNum === 8) || (stringNum === 10) || (stringNum === 12) || (stringNum === 14)){
                string.params = string6Params.slice();
                renderTable(string,stringNum,frameNum);
            }else{
                string.params = string7Params.slice();
                renderTable(string,stringNum,frameNum);                
            }  
  
        })
    })
}
function renderTable(string, stringNum, frameNum){
    var tableBody = document.createElement('tbody');
    tableBody.setAttribute('data-frame-string-id', (frameNum + 1) + '-' + stringNum);
    string.params.forEach(function(param){
        var row = document.createElement('tr');
        for(key in param){
            var cell = document.createElement('td');
            if(key == 'value'){
               var cellValue = document.createElement('input');
               cellValue.type = 'number';
               cell.setAttribute('data-param-name', key)
               cell.appendChild(cellValue);
               row.appendChild(cell);
               continue;
            }
            cell.innerHTML = param[key]
            cell.setAttribute('data-param-name', key)
            row.appendChild(cell);
        }
        tableBody.appendChild(row);
    })
    document.querySelector('table').appendChild(tableBody);
}

var currentActiveFrame = null, prevActiveFrame = null;
var currentActiveNavString = null, prevActiveNavString = null;
var currentActiveTable = null, prevActiveTable = null;

function selectFrame(event){
    selectedFrame = event.currentTarget;
    if(selectedFrame === currentActiveFrame){
        selectedFrame.classList.toggle('active');
        currentActiveFrame = selectedFrame;
        if(currentActiveTable){
            currentActiveTable.style.display = 'none';
            currentActiveNavString.classList.remove('active');
        }    
        if(currentActiveFrame.classList.value.indexOf('active') == -1){
            showNavStrings(false)
        }else{
            showNavStrings(true)
        }
    }else{
        if(currentActiveFrame){//not first time
            showNavStrings(false);
            prevActiveFrame = currentActiveFrame;
            prevActiveFrame.classList.remove('active');
            if(currentActiveTable){
                currentActiveTable.style.display = 'none';
                currentActiveNavString.classList.remove('active');
            }    
        }
        currentActiveFrame = selectedFrame;
        currentActiveFrame.classList.add('active'); 
        showNavStrings(true);       
    }
};
function selectNavString(event){
    event.stopPropagation();
    selectedNavString = event.currentTarget;
    if(selectedNavString === currentActiveNavString){
        selectedNavString.classList.toggle('active');
        currentActiveNavString = selectedNavString;
        currentActiveTable =  document.querySelector('[data-frame-string-id="' + currentActiveFrame.getAttribute('data-frame-id') + '-' + currentActiveNavString.getAttribute('data-string-id') + '"]');
        currentActiveTable.style.display = currentActiveTable.style.display == 'none'?"table-row-group":'none';
    }else{
        if(currentActiveNavString){//not first time
            prevActiveNavString = currentActiveNavString;
            prevActiveNavString.classList.remove('active');
            prevActiveTable = document.querySelector('[data-frame-string-id="' + currentActiveFrame.getAttribute('data-frame-id') + '-' + prevActiveNavString.getAttribute('data-string-id') + '"]');
            prevActiveTable.style.display = "none";

        }
        currentActiveNavString = selectedNavString;
        currentActiveNavString.classList.add('active');
        currentActiveTable =  document.querySelector('[data-frame-string-id="' + currentActiveFrame.getAttribute('data-frame-id') + '-' + currentActiveNavString.getAttribute('data-string-id') + '"]');
        currentActiveTable.style.display = "table-row-group";
    }

}

function showNavStrings(option){
    currentActiveFrame.children[0].style.display = option?'block':'none';
}

makeList(superFrame,frames);
makeTables(superFrame,frames);

function translateToBinary(value, elem){
    var digitsNum = parseInt(elem.querySelector('[data-param-name="digitsNum"]').innerHTML);
    var result = value.toString(2);
    while(result.length < digitsNum){
        result = '0' + result ;
    } 
    return result;
}

generateStringBtn.addEventListener('click',function(e){
    e.preventDefault();
    document.querySelector('.working-area__string--decimial').innerHTML = '';
    document.querySelector('.working-area__string--binary').innerHTML = '';
    currentActiveTable.querySelectorAll('input').forEach(function(input){
        var stringPartElem = document.createElement('span');
        stringPartElem.style.padding = '0 3px'
        stringPartElem.innerHTML = input.value;
        document.querySelector('.working-area__string--decimial').appendChild(stringPartElem);
        var stringPartElem2 = document.createElement('span');
        stringPartElem2.style.padding = '0 3px'
        stringPartElem2.innerHTML = translateToBinary(parseInt(input.value), input.parentElement.parentElement );
        document.querySelector('.working-area__string--binary').appendChild(stringPartElem2);        
    });
})
